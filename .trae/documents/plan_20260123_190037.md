# 修复JAX不支持字符串类型的错误

## 1. 错误分析
- 错误位置：`data_loader.py` 第475行
- 错误原因：batch中包含字符串类型字段（dtype <U46，即Unicode字符串），JAX只支持数值类型
- 影响范围：数据加载过程中的JAX数组转换

## 2. 问题根源
- 数据集返回的batch包含额外字段（如"task"字符串字段）
- 这些字段未被transforms移除，导致在转换为JAX数组时失败
- JAX的`make_array_from_process_local_data`函数只支持数值类型

## 3. 修复方案
- 在数据加载器的`__iter__`方法中，过滤batch只保留必要字段
- 定义允许的字段列表，包括Observation所需的字段和actions
- 在转换为JAX数组前过滤掉所有其他字段

## 4. 具体修改

### 4.1 修改TorchDataLoader.__iter__方法
在`TorchDataLoader.__iter__`方法中，添加batch过滤逻辑：

1. 定义允许的字段列表
2. 在获取batch后，过滤只保留允许的字段
3. 然后再转换为JAX数组

### 4.2 修改RLDSDataLoader.__iter__方法
同样在`RLDSDataLoader.__iter__`方法中添加相同的过滤逻辑

## 5. 预期结果
- 修复后的数据加载器只处理数值类型字段
- 成功将batch转换为JAX数组
- 训练过程能够正常进行

## 6. 允许的字段列表
```python
allowed_fields = {
    "image",
    "image_mask",
    "state",
    "tokenized_prompt",
    "tokenized_prompt_mask",
    "token_ar_mask",
    "token_loss_mask",
    "actions",
}
```